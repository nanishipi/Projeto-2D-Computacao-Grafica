<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto 1 - Jogo</title>
</head>
<body>
    
    <canvas id="myCanvas" style="width: 100%;">
		Your browser does not support HTML5 Canvas.
	</canvas>

    

    <script>
        const canvas = document.querySelector("#myCanvas");
        canvas.width = innerWidth;
        canvas.height = innerHeight;
        const ctx = canvas.getContext("2d");
        let backgroundImage = new Image()
        backgroundImage.src = 'images/backgroundImage.png'
        const W = canvas.width
        const H = canvas.height
        let spriteFramecounter = 0
        let spriteStopFrames = 0
        let spriteMovesX = 0
        let harpoonMovesX = spriteMovesX;

        //Loading Images
        let spriteTestImage = new Image()
        spriteTestImage.src = 'images/characterRunning.png'
        let spriteStop = new Image()
        spriteStop.src="images/characterStop.png"
        let spriteTestImage2 = new Image()
        spriteTestImage2.src = 'images/characterRunning 2.png'
        let borderH = new Image()
        borderH.src = 'images/wave.png'
        let borderV = new Image()
        borderV.src = 'images/wave_vertical.png'
        let brickBorder = new Image()
        brickBorder.src = 'images/bricks.png'

        class Ball{
            constructor(x,y,r,c,v){
                this.xBall = x; //x posição inicial
                this.yBall = y; //y posição inicial
                this.rBall = r; //raio da bola
                this.cBall = c; //cor da bola 
                this.vBall = v; //velocidade

            }

            draw(){
                ctx.fillStyle = this.cBall;

                ctx.beginPath();
                ctx.arc(this.xBall, this.yBall, this.rBall, 0, 2 * Math.PI);
                ctx.fill();


            }

            update(){
                if (this.yBall<=H/2 + 230 - this.rBall) {
                    this.yBall+=this.vBall
                }
            }
        }


        class Player1{
            constructor(x,y,v){
                this.xPlayer = x; //x posição inicial
                this.yPlayer = y; //y posição inicial
                this.vPlayer = v; //velocidade de andamento
            }

            draw(){
                ctx.drawImage(spriteStop, spriteStopFrames * 501, 0, 501, 526, spriteMovesX * 40 + W / 2 - 100, H / 2 + 150, 108, 108)
            }

            update(){
                if(moveRight){
                spriteFramecounter++
                spriteMovesX++;
                    if(spriteFramecounter == 8){
                        spriteFramecounter = 0
                        
                    }         
                    }
                    else{
                        spriteStopFrames++
                        if(spriteStopFrames == 8){
                            spriteStopFrames = 0
                        }
                    ctx.drawImage(spriteStop, spriteStopFrames * 501, 0, 501, 526, spriteMovesX * 40 + W / 2 - 100, H / 2 + 150, 108, 108)
                    console.log("ELESE")
                    }

                if (moveLeft){
                    spriteFramecounter++
                    spriteMovesX--;
                        if(spriteFramecounter == 8){
                            spriteFramecounter = 0
                        }
                }else{
                    spriteStopFrames++
                    if(spriteStopFrames == 8){
                        spriteStopFrames = 0
                    }
                    ctx.drawImage(spriteStop, spriteStopFrames * 501, 0, 501, 526, spriteMovesX * 40 + W / 2 - 100, H / 2 + 150, 108, 108)
                }
            }
        }

        class Harpoon{
            constructor(x, y, v){
                this.xHarpoon = x; //x posição inicial
                this.yHarpoon = y; //y posição inicial
                this.vHarpoon = v; //velociade do arpão
            }

            draw()
            {   
                //Triângulo do arpão
                ctx.fillStyle = 'red'
                ctx.beginPath();
                ctx.moveTo(this.xHarpoon + 50, this.yHarpoon + 25)
                ctx.lineTo(this.xHarpoon + 65, this.yHarpoon + 25)
                ctx.lineTo(this.xHarpoon + 57, this.yHarpoon + 10)
                ctx.fill();
                ctx.closePath();
                //Retângulos do arpão
                ctx.beginPath();
                ctx.fillStyle = 'grey'
                ctx.fillRect(this.xHarpoon + 53, this.yHarpoon + 45, 10, 20)
                ctx.fillStyle = 'red'
                ctx.fillRect(this.xHarpoon + 55, this.yHarpoon + 35 , 5, 10)
                ctx.fillStyle = 'black'
                ctx.fillRect(this.xHarpoon + 55, this.yHarpoon + 25 , 5, 10)
                ctx.stroke();
                ctx.fill();
            }

            update(){
                if (moveRight) {
                    harpoonMovesX++;
                }

                if (moveLeft){
                    harpoonMovesX--;
                }
            }
        }

        let harpoon1 = new Harpoon(harpoonMovesX * 40 + W / 2 - 100, H / 2 + 150)

        let player1 = new Player1

        let ball = new Array();

        function newBall(){
            ball.push(new Ball( Math.random() * W, 0, Math.random() * 40, 'rgba(0,0,0,0.9)', Math.random() * 4))

        }
        for (let i = 0; i < 4; i++) {
            newBall()

        }

        //Criação da personagem
        let personagem = new Image();
            personagem.src = "images/SpriteTestImage.png"
        let moveRight = false
        let moveLeft = false;
        let characterCounter1 = 0;
        //Controlador de comandos de movimento
        function arrowPressed(e){
            if(e.key == "ArrowRight"){
                moveRight = true;
                //console.log("clicou")
            }
            if(e.key == "ArrowLeft"){
                moveLeft = true;
                //console.log("clicou")
            }
            if (e.key == ""){
                
            }
        }

        function arrowReleased(e){
            if(e.key == "ArrowRight"){
                //console.log("Largou")
                moveRight = false;
            }
            if (e.key == "ArrowLeft"){
                //console.log("Largou");
                moveLeft = false;
            }
        }

        //Controladores de listners
        window.addEventListener("keydown", arrowPressed)
        window.addEventListener("keyup", arrowReleased)


        backgroundImage.onload = function(){
                render();
                window.setInterval(player1.update, 1000/10)
        }
        
        //Teste sprite move
            function moveTest(){
              
            }

        //Fim teste sprite move

        //ctx.drawImage(spriteStop, spriteStopFrames * 501, 0, 501, 526, spriteMovesX * 20 + W / 2 - 100, H / 2 + 150, 108, 108)
         

        function render(){
            //console.log("Funcao")
            ctx.clearRect(0,0,W,H)
            ctx.drawImage(backgroundImage,0,0,W,H)
            
            if(!moveRight && !moveLeft){
               
                player1.draw()

            }
            else if (moveRight){
                ctx.drawImage(spriteTestImage, spriteFramecounter * 500, 0, 517, 517, spriteMovesX * 40 + W / 2 - 100, H / 2 + 150, 100, 100)
            }
            else{
                ctx.drawImage(spriteTestImage2, spriteFramecounter * 500, 0, 517, 517, spriteMovesX * 40 + W / 2 - 100, H / 2 + 150, 100, 100)
            }
           //Controlador de personagem

           //Controlar o arpão
           if(!moveRight && !moveLeft){

                harpoon1.draw(harpoonMovesX * 40 + W / 2 - 100, H / 2 + 150)

           }
           else if (moveRight){
               harpoon1.draw(harpoonMovesX * 40 + W / 2 - 100, H / 2 + 150)
           }
           else{
                harpoon1.draw(harpoonMovesX * 40 + W / 2 - 100, H / 2 + 150)
           }
            
            //console.log(moveRight)
            //ctx.drawImage(personagem,characterCounter1 * 3 + W / 2 - 100, H / 2 + 150,100,100)

            //border
            ctx.fillRect(0,0,W / 50, H );
            ctx.fillRect(W - W/ 50,0,W / 50, H );
            ctx.fillRect(0,0,W, H / 30 );
            ctx.fillRect(0,H - H / 30,W, H / 30 );

            //BrickBorder
            ctx.drawImage(brickBorder, W / 50 ,0 ,W - W / 50, H / 30 )
            ctx.drawImage(brickBorder, W / 50 ,H - H / 30, W - W / 50 , H / 30)
            ctx.drawImage(brickBorder, 0 , 0, W / 50, H)
            ctx.drawImage(brickBorder, W - W / 50 , 0, W / 50, H)

            //Neon Border
            //ctx.drawImage(borderV, 0 , 0, W / 50, H)
            //ctx.drawImage(borderV, W - W / 50 , 0, W / 50, H)
            //ctx.drawImage(borderH, 0 ,0 ,W , H / 30 )
            //ctx.drawImage(borderH, 0 ,H - H / 30, W , H / 30)


            ball.forEach(ball => {
                ball.draw() 
                ball.update()
                console.log(ball)
            });
            window.requestAnimationFrame(render)
        }
    </script>
</body>
</html>
